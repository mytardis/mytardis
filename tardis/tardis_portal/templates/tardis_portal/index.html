{% extends "tardis_portal/portal_template.html" %}
{% load static %}
{% load humanize %}
{% load render_bundle from webpack_loader %}
{% load experiment_tags %}
{% load experimentstats %}
{% load bleach_tag %}
{% load usage_stats_tags %}

{% block script %}
{% endblock script %}

{% block content %}
<div id="content" class="container-fluid">
  <div class="page-header">
    <h1 class="mb-1">{{site_title|default:'MyTardis'}} Data Store</h1>
  </div>

  <div class="row">
    <div class="col-md-8">
      <p>
        Store.Monash assists researchers in storing, managing, sharing and disseminating data generated by scientific instruments.
      </p>
      <p>
        For more information about the MyTardis project in general, please visit <a href="https://www.mytardis.org/">mytardis.org</a>.
      </p>

      <h2>Statistics</h2>

      <div class="row mb-4">
        <div class="col">
          <h5 class="text-uppercase text-muted mb-0">Storage</h5>
          <span class="h2 font-weight-bold mb-0 stat-counter" data-current="0"
            data-target="{{ stats.storage|intdivideby:1000 }}">-</span>PB
        </div>
        <div class="col">
          <h5 class="text-uppercase text-muted mb-0">Files</h5>
          <span class="h2 font-weight-bold mb-0 stat-counter" data-current="0"
            data-target="{{ stats.files }}">-</span>
        </div>
        <div class="col">
          <h5 class="text-uppercase text-muted mb-0">Datasets</h5>
          <span class="h2 font-weight-bold mb-0 stat-counter" data-current="0" data-target="{{ stats.datasets }}">-</span>
        </div>
        <div class="col">
          <h5 class="text-uppercase text-muted mb-0">Experiments</h5>
          <span class="h2 font-weight-bold mb-0 stat-counter" data-current="0" data-target="{{ stats.experiments }}">-</span>
        </div>
      </div>

      <h2>Facilities</h2>

      {% for facility in facility_stats %}
        <div style="float: left;">
          <div class="rounded border shadow-sm facility"
              style="width: 200px; height: 200px; margin: 5px; background: url('{% static 'images/facilities' %}/{{ facility.id }}.png')">
              <div style="color: white; text-align: center; background-color: #34568c; " class="rounded-top">
                  <strong>{{ facility.name }}</strong>&nbsp;{{ facility.stats.storage|default:0|intdivideby:1000|intcomma }}<br />
              </div>
            </div>
        </div>
      {% endfor %}
    </div>
    <div class="col-md-4">
      <h2>Recent Public Experiments</h2>
      {% for exp in public_experiments %}
        <div class="card mb-3 shadow-sm">
          <div id="public-toggle-{{exp.id}}"
              class="card-header accordion-toggle public-experiment py-2"
              data-bs-toggle="collapse" data-bs-parent="#public-experiments">
            <div class="row">
              <div class="col px-1 pb-1">
                <input type="hidden" class="exp-index" value="{{ forloop.counter }}">
                <a class="card-title explink"
                  href="{% url 'tardis_portal.view_experiment' exp.id %}">{{ exp.title }}</a>

                <div class="card-subtitle text-muted small">
                  {% for author in exp.experimentauthor_set.all %}
                    <span property="dc:author">{{ author.author }}{% if not forloop.last %}, {% endif %}</span>
                  {% endfor %}
                  &nbsp;
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col" style="margin-bottom: -15px;">
                <div class="badges" id="badge-{{exp.id}}"></div>
              </div>
            </div>
          </div>
          <div id="collapsepub-{{exp.id}}" class="card-body py-2 collapse" data-parent="#public-experiments">
            <div class="row">
              <div class="col-md-9 px-1">
                <div class="accordion-inner">
                  <p class="card-text small mb-1">{{exp.description|default:"<em>No description</em>"|bleach}}</p>
                  <div id="public-recent-datasets-{{exp.id}}"></div>
                </div> {% comment %}class="accordion-inner"{% endcomment %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div> {% comment %}class="row"{% endcomment %}
</div> {% comment %}id="content"{% endcomment %}
<input type="hidden" id="exps-expand-accordion" value="{{ exps_expand_accordion }}">
{% render_bundle 'tardis_portal_index' %}
{% render_bundle 'index_page_badges' %}
{% render_bundle 'usage_stats' %}

{% endblock content %}
