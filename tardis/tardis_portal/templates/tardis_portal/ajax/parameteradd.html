{% load formfieldfilters %}
<script type="text/javascript">
    // This could be better placed inside each jqModal call as an onHide callback
    $('.jqmClose').unbind('click.close').bind('click.close', function(){
        {% if type == "datafile" %}
        var parentdatafile = $("#jqmAlertContent{{type}}A{{parentObject.id}}").parents('.datafile');
        var toggle = parentdatafile.find('.datafile_info_toggle');	
            
        toggle.text('[Hide]');
        toggle.next().show();
        toggle.next().html(loadingHTML);
        toggle.next().load(toggle.attr("href"));				
        {% endif %}		

        {% if type == "dataset" %}		
        var parentdatafile = $("#jqmAlertContent{{type}}A{{parentObject.id}}").parents('.dataset');
        var toggle = parentdatafile.find('.dataset_metadata_toggle');	

        toggle.text('[Hide]');
        toggle.next().show();
        toggle.next().html(loadingHTML);
        toggle.next().load(toggle.attr("href"));	
        {% endif %}		
    });	
</script>

{% if success %}
	Parameters saved successfully.
	
{% else %}
	<p>
		<strong>Schema</strong>
		<select id="schemaselect" data-type="{{type}}" data-parent_object_id="{{parentObject.id}}">
		{% for schema in all_schema %}
			<option value="{{schema.id}}" {% if schema.id == schema_id %}selected{% endif %}>{{schema.namespace}}</option>
		{% endfor %}
		</select>
	</p>
	<form id="add_metadata_form" action='/ajax/add_{{type}}_parameters/{{parentObject.id}}/{{schema.id}}/' method='post' data-type="{{type}}" data-parent_object_id="{{parentObject.id}}">
		{{ form.non_field_errors }}
	    {% for field in form %}
	        <div class="fieldWrapper">
	            {{ field.errors }}
	            {{ field.label_tag }}:
				<br/>{{ field }}
	        </div>
	    {% endfor %}
		<span/>
	

		<select id="parameternameselect_{{type}}_{{parentObject.id}}">
		{% for pn in parameternames %}
	
			<option value="{{pn.name|parametername_form}}">{{pn.full_name}} {% if pn.units %}({{pn.units}}){% endif %}</option>

		{% endfor %}
		</select>

		<a id="add_new_parameter">Add Metadata Parameter</a>
  		
		<p><em>Leave a parameter blank to remove</em></p>
		{% if not valid %}
			<p style="color: red"><em>There were errors in the parameter submission. Please fix and resubmit.</em></p>
		{% endif %}		
		<p><input id="submit" type="submit" value="submit" /></p>
		
	</form>	
{% endif %}
